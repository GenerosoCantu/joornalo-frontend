{"version":3,"file":"static/webpack/static\\development\\pages\\section\\[section]\\[date]\\[id].js.35e6b3514e475716a00e.hot-update.js","sources":["webpack:///./pages/section/[section]/[date]/.js"],"sourcesContent":["// import { useRouter } from 'next/router'\r\nimport React, { useEffect, useContext } from 'react';\r\nimport Link from 'next/link';\r\nimport fetch from 'isomorphic-unfetch';\r\nimport Layout from '../../../../components/MyLayout';\r\nimport redirect from 'next-redirect';\r\nimport Template from \"../../../../components/Template.js\";\r\nimport Error from 'next/error'\r\nimport ConfigContext from '../../../../context/config/configContext';\r\n\r\n// url ===> http://localhost:3000/section/world/2020-01-11/iraq-iran-us-troops-4c50e545-539e-4893-b505-1edc2de3c977\r\n\r\n\r\nconst News = (props) => {\r\n\r\n  const configContext = useContext(ConfigContext);\r\n  const { agent, setAgent } = configContext;\r\n\r\n  if (!agent && props.agent) {\r\n    console.log('Set Agent  ************************');\r\n    useEffect(() => {\r\n      setAgent(props.agent);\r\n      // eslint-disable-next-line\r\n    }, []);\r\n  }\r\n\r\n  if (props.notFound) {\r\n    return <Error statusCode='404' />\r\n  }\r\n\r\n  return (\r\n    <Layout>\r\n      <h1>News story</h1>\r\n      <h1>uuid:: {props.uuid}</h1>\r\n      <h1>title:: {props.data.title}</h1>\r\n\r\n      <ul>\r\n        <li>\r\n          <Link href=\"/section/[section]/[date]/[id]\" as=\"/section/world/2020-01-11/iraq-iran-us-troops-4c50e545-539e-4893-b505-1edc2de3c9ZZ\">\r\n            <a>Bad link</a>\r\n          </Link>\r\n        </li>\r\n        <li>\r\n          <Link href=\"/section/[section]/[date]/[id]\" as=\"/section/world/2020-01-11/iraq-iran-us-troops-4c50e545-539e-4893-b505-1edc2de3c977\">\r\n            <a>Good link</a>\r\n          </Link>\r\n        </li>\r\n        <li>\r\n          <Link href=\"/section/[section]/[date]/[id]\" as=\"/section/world-europe/2020-01-11/harry-meghan-drop-royal-duties-4c50e545-539e-4893-b505-1edc2de3c988\">\r\n            <a>Good link</a>\r\n          </Link>\r\n        </li>\r\n        <li>\r\n          <Link href=\"/section/[section]/[date]/[id]\" as=\"/section/world-middleeast/2020-01-11/iraq-iran-us-troops-4c50e545-539e-4893-b505-1edc2de3c999\">\r\n            <a>Good link</a>\r\n          </Link>\r\n        </li>\r\n      </ul>\r\n\r\n      <Template grid={props.template} data={props.data} />\r\n\r\n    </Layout>\r\n  )\r\n}\r\n\r\nNews.getInitialProps = async function (context) {\r\n\r\n  const { section, date, id } = context.query;\r\n  const uuid = id.slice(-36);\r\n  const url = `/section/${section}/${date}/${id}`;\r\n  const path = `https://data.joornalo.com/news/${uuid.charAt(0)}/${uuid.charAt(1)}/${uuid}.json`;\r\n\r\n  console.log(uuid);\r\n\r\n  const initialAgent = () => {\r\n\r\n    let userAgent\r\n    if (process.browser) {\r\n      userAgent = navigator.userAgent\r\n    } else {\r\n      userAgent = context.req.headers['user-agent']\r\n    }\r\n\r\n    const mobilex = userAgent.match(/(Mobile)/g);\r\n    const android = userAgent.match(/(Android)/g);\r\n    const iPad = userAgent.match(/(iPad)/g);\r\n\r\n    const mobile = Boolean(mobilex) && !iPad;\r\n    const tablet = (!mobilex && Boolean(android)) || Boolean(iPad);\r\n    const desktop = !mobile && !tablet;\r\n\r\n    return ((desktop || tablet) ? 'desktop' : 'mobile');\r\n\r\n  };\r\n\r\n\r\n  try {\r\n    const res = await fetch(path);\r\n    const data = await res.json();\r\n\r\n    if (url !== data['url']) {\r\n      console.log(`Bad URL...redirected`);\r\n      return redirect(context, data['url'], 308);\r\n    }\r\n\r\n    const agent = initialAgent();\r\n    const tmpl = agent + '-' + data['template'];\r\n\r\n    const templateUrl = `https://data.joornalo.com/templates/news/${tmpl}.json`;\r\n    const res2 = await fetch(templateUrl);\r\n    const template = await res2.json();\r\n\r\n    return {\r\n      uuid,\r\n      data,\r\n      agent,\r\n      template\r\n    };\r\n\r\n  } catch (e) {\r\n    console.log(`Page not found`);\r\n    console.log(e);\r\n    return redirect(context, '/notfound', 302);\r\n  }\r\n\r\n};\r\n\r\nexport default News"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAEA;AAFA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA,qBAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AA7BA;AAAA;AAAA;AACA;AADA;AAgCA;AAhCA;AAAA;AACA;AADA;AAiCA;AACA;AAlCA;AAAA;AAAA;AAAA;AACA;AAmCA;AApCA;AACA;AADA;AAwCA;AACA;AAEA;AA3CA;AAAA;AACA;AADA;AA4CA;AA5CA;AAAA;AACA;AADA;AA6CA;AA7CA;AAgDA;AACA;AACA;AACA;AAJA;AACA;AAhDA;AAAA;AAAA;AAuDA;AACA;AAxDA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA6DA;;;;A","sourceRoot":""}