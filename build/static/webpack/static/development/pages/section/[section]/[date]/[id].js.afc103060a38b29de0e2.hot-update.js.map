{"version":3,"file":"static/webpack/static\\development\\pages\\section\\[section]\\[date]\\[id].js.afc103060a38b29de0e2.hot-update.js","sources":["webpack:///./store/actions/newsActions.js"],"sourcesContent":["import store from '../../pages/store';\r\nimport { GET_NEWS, SET_LOADING, ADD_TEMPLATE, NEWS_ERROR, INIT_AGENT, GET_CONFIG, GET_OTHERNEWS } from '../types';\r\nimport { initAgent, test } from '../../services/configService';\r\nimport axios from 'axios';\r\nimport Parser from 'html-react-parser';\r\n\r\n\r\nconst getTemplate = async (req, template, agent) => {\r\n  try {\r\n    setLoading();\r\n\r\n    const tmpl = agent + '-' + template;\r\n    const templateUrl = `https://data.joornalo.com/templates/news/${tmpl}.json`;\r\n\r\n    const res = await axios.get(templateUrl);\r\n\r\n    return res.data;\r\n\r\n  } catch (err) {\r\n    console.log('***********Template Error');\r\n    dispatch({\r\n      type: NEWS_ERROR,\r\n      payload: err.statusText\r\n    });\r\n  }\r\n\r\n};\r\n\r\nexport const getOtherNews = (section) => async (dispatch, getState) => {\r\n  try {\r\n    setLoading();\r\n\r\n    const moreUrl = `https://data.joornalo.com/news/${section}-more-news.json`;\r\n\r\n    const res = await axios.get(moreUrl);\r\n\r\n    dispatch({\r\n      type: GET_OTHERNEWS,\r\n      payload: {\r\n        topNews: res.data.topNews,\r\n        moreNews: res.data.moreNews,\r\n      }\r\n    });\r\n\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEWS_ERROR,\r\n      payload: 'NotFound'\r\n    });\r\n  }\r\n};\r\n\r\nexport const getNews = (section, date, uuid, url, req) => async (dispatch, getState) => {\r\n  try {\r\n    setLoading();\r\n\r\n    const path = `https://data.joornalo.com/news/${uuid.charAt(0)}/${uuid.charAt(1)}/${uuid}.json`\r\n\r\n    const res = await axios.get(path);\r\n\r\n    if (url !== res.data['url']) {\r\n      dispatch({\r\n        type: NEWS_ERROR,\r\n        payload: `Redirect: ${res.data['url']}`\r\n      });\r\n    }\r\n\r\n    const agent = getState().news.agent;\r\n    const tmpl = agent + '-' + res.data['template'];\r\n\r\n    let template = getState().news.templates[tmpl];\r\n\r\n    if (!template) {\r\n      template = await getTemplate(req, res.data['template'], getState().news.agent);\r\n      dispatch({\r\n        type: ADD_TEMPLATE,\r\n        payload: {\r\n          template: { [tmpl]: template }\r\n        }\r\n      });\r\n    }\r\n\r\n    // let tmp = unescape(res.data.text);\r\n    // let find = tmp.split('<embed id=\"');\r\n\r\n    // for (let i = find.length - 1; i--;) {\r\n    //   let mediaNum = parseInt(find[i + 1].charAt(0));\r\n    //   if (res.data.media[mediaNum - 1]) {\r\n    //     find[i + 1] = '<div class=\"embed\">' + res.data.media[mediaNum - 1].embed + '</div>' + find[i + 1].substring(5);\r\n    //   } else {\r\n    //     find[i + 1] = find[i + 1].substring(5);\r\n    //   }\r\n    // }\r\n\r\n    // tmp = find.join('');\r\n    // find = tmp.split('<image id=\"');\r\n    // for (let i = find.length - 1; i--;) {\r\n    //   let imageNum = parseInt(find[i + 1].charAt(0));\r\n    //   if (res.data.images[imageNum - 1]) {\r\n    //     find[i + 1] = '<img src=\"https://data.joornalo.com/news/4/c/' + res.data.images[imageNum - 1].url + '\" />' + find[i + 1].substring(5);\r\n    //   } else {\r\n    //     find[i + 1] = find[i + 1].substring(5);\r\n    //   }\r\n    // }\r\n\r\n    // res.data.modText = Parser(find.join(''));\r\n\r\n\r\n    // res.data.mainImgUrl = 'https://data.joornalo.com/news/4/c/' + res.data.images[0].url;\r\n\r\n    //console.log(data);\r\n\r\n    dispatch({\r\n      type: GET_NEWS,\r\n      payload: {\r\n        news: res.data,\r\n        template: template\r\n      }\r\n    });\r\n\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEWS_ERROR,\r\n      payload: 'NotFound'\r\n    });\r\n  }\r\n};\r\n\r\n// Set loading to true\r\nexport const setLoading = () => {\r\n  return {\r\n    type: SET_LOADING\r\n  };\r\n};\r\n\r\n\r\nexport const getConfig = (req) => async dispatch => {\r\n  try {\r\n    const configUrl = `https://data.joornalo.com/config.json`\r\n    const templatesUrl = `https://data.joornalo.com/templates/news/templates.json`;\r\n\r\n    const [config, templates, agent] = await Promise.all([\r\n      axios.get(configUrl),\r\n      axios.get(templatesUrl),\r\n      initAgent(req)\r\n    ]);\r\n\r\n    dispatch({\r\n      type: GET_CONFIG,\r\n      payload: {\r\n        config: config.data,\r\n        templates: templates.data,\r\n        agent: agent\r\n      }\r\n    });\r\n\r\n  } catch (err) {\r\n    // dispatch({\r\n    //   type: NEWS_ERROR,\r\n    //   payload: 'NotFound'\r\n    // });\r\n  }\r\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AALA;AAAA;AACA;AADA;AAOA;AAPA;AACA;AADA;AAAA;AAAA;AAYA;AACA;AACA;AACA;AAFA;AACA;AAdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAoBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAJA;AAAA;AACA;AADA;AAMA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAFA;AARA;AAAA;AACA;AADA;AAAA;AAAA;AAiBA;AACA;AACA;AAFA;AACA;AAlBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAJA;AAAA;AACA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AAnBA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAqBA;AACA;AACA;AACA;AACA;AADA;AAFA;AACA;AAvBA;AA8BA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAFA;AA5DA;AAAA;AACA;AADA;AAAA;AAAA;AAqEA;AACA;AACA;AAFA;AACA;AAtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA4EA;AACA;AACA;AADA;AAGA;AAGA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AAKA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAXA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}