{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport store from '../../pages/store';\nimport { GET_NEWS, SET_LOADING, ADD_TEMPLATE, NEWS_ERROR, INIT_AGENT, GET_CONFIG } from '../types';\nimport { initAgent, test } from '../../services/configService';\nimport axios from 'axios';\n\nconst getTemplate = async (req, template, agent) => {\n  try {\n    setLoading();\n    const tmpl = agent + '-' + template;\n    const templateUrl = `https://data.joornalo.com/templates/news/${tmpl}.json`;\n    const res = await axios.get(templateUrl);\n    return res.data;\n  } catch (err) {\n    console.log('***********Template Error');\n    dispatch({\n      type: NEWS_ERROR,\n      payload: err.statusText\n    });\n  }\n};\n\nexport const getNews = (section, date, uuid, url, req) => async (dispatch, getState) => {\n  try {\n    setLoading();\n    const path = `https://data.joornalo.com/news/${uuid.charAt(0)}/${uuid.charAt(1)}/${uuid}.json`;\n    const res = await axios.get(path);\n\n    if (url !== res.data['url']) {\n      dispatch({\n        type: NEWS_ERROR,\n        payload: `Redirect: ${res.data['url']}`\n      });\n    }\n\n    const agent = getState().news.agent;\n    const tmpl = agent + '-' + res.data['template'];\n    let template = getState().news.templates[tmpl];\n\n    if (!template) {\n      template = await getTemplate(req, res.data['template'], getState().news.agent);\n      dispatch({\n        type: ADD_TEMPLATE,\n        payload: {\n          template: {\n            [tmpl]: template\n          }\n        }\n      });\n    }\n\n    dispatch({\n      type: GET_NEWS,\n      payload: {\n        news: res.data,\n        template: template\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: NEWS_ERROR,\n      payload: 'NotFound'\n    });\n  }\n}; // Set loading to true\n\nexport const setLoading = () => {\n  return {\n    type: SET_LOADING\n  };\n};\nexport const getConfig = req => async dispatch => {\n  try {\n    const configUrl = `https://data.joornalo.com/config.json`;\n    const templatesUrl = `https://data.joornalo.com/templates/news/templates.json`;\n    const [config, templates, agent] = await _Promise.all([axios.get(configUrl), axios.get(templatesUrl), initAgent(req)]);\n    dispatch({\n      type: GET_CONFIG,\n      payload: {\n        config: config.data,\n        templates: templates.data,\n        agent: agent\n      }\n    });\n  } catch (err) {// dispatch({\n    //   type: NEWS_ERROR,\n    //   payload: 'NotFound'\n    // });\n  }\n};","map":null,"metadata":{},"sourceType":"module"}