{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport store from '../../pages/store';\nimport { GET_NEWS, SET_LOADING, ADD_TEMPLATE, NEWS_ERROR, INIT_AGENT, GET_CONFIG, GET_OTHERNEWS } from '../types';\nimport { initAgent, test } from '../../services/configService';\nimport axios from 'axios';\nimport Parser from 'html-react-parser';\n\nvar getTemplate = function getTemplate(req, template, agent) {\n  var tmpl, templateUrl, res;\n  return _regeneratorRuntime.async(function getTemplate$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          setLoading();\n          tmpl = agent + '-' + template;\n          templateUrl = \"https://data.joornalo.com/templates/news/\".concat(tmpl, \".json\");\n          _context.next = 6;\n          return _regeneratorRuntime.awrap(axios.get(templateUrl));\n\n        case 6:\n          res = _context.sent;\n          return _context.abrupt(\"return\", res.data);\n\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context[\"catch\"](0);\n          console.log('***********Template Error');\n          dispatch({\n            type: NEWS_ERROR,\n            payload: _context.t0.statusText\n          });\n\n        case 14:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 10]]);\n};\n\nexport var getOtherNews = function getOtherNews(section) {\n  return function _callee(dispatch, getState) {\n    var moreUrl, res;\n    return _regeneratorRuntime.async(function _callee$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            setLoading();\n            moreUrl = \"https://data.joornalo.com/news/\".concat(section, \"-more-news.json\");\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(axios.get(moreUrl));\n\n          case 5:\n            res = _context2.sent;\n            dispatch({\n              type: GET_OTHERNEWS,\n              payload: {\n                topNews: res.data.topNews,\n                moreNews: res.data.moreNews\n              }\n            });\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](0);\n            dispatch({\n              type: NEWS_ERROR,\n              payload: 'NotFound'\n            });\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 9]]);\n  };\n};\nexport var getNews = function getNews(section, date, uuid, url, req) {\n  return function _callee2(dispatch, getState) {\n    var path, res, agent, tmpl, template, tmp, find, i, mediaNum, _i, imageNum;\n\n    return _regeneratorRuntime.async(function _callee2$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            setLoading();\n            path = \"https://data.joornalo.com/news/\".concat(uuid.charAt(0), \"/\").concat(uuid.charAt(1), \"/\").concat(uuid, \".json\");\n            _context3.next = 5;\n            return _regeneratorRuntime.awrap(axios.get(path));\n\n          case 5:\n            res = _context3.sent;\n\n            if (url !== res.data['url']) {\n              dispatch({\n                type: NEWS_ERROR,\n                payload: \"Redirect: \".concat(res.data['url'])\n              });\n            }\n\n            agent = getState().news.agent;\n            tmpl = agent + '-' + res.data['template'];\n            template = getState().news.templates[tmpl];\n\n            if (template) {\n              _context3.next = 15;\n              break;\n            }\n\n            _context3.next = 13;\n            return _regeneratorRuntime.awrap(getTemplate(req, res.data['template'], getState().news.agent));\n\n          case 13:\n            template = _context3.sent;\n            dispatch({\n              type: ADD_TEMPLATE,\n              payload: {\n                template: _defineProperty({}, tmpl, template)\n              }\n            });\n\n          case 15:\n            tmp = unescape(res.data.text);\n            find = tmp.split('<embed id=\"');\n\n            for (i = find.length - 1; i--;) {\n              mediaNum = _parseInt(find[i + 1].charAt(0));\n\n              if (res.data.media[mediaNum - 1]) {\n                find[i + 1] = '<div class=\"embed\">' + res.data.media[mediaNum - 1].embed + '</div>' + find[i + 1].substring(5);\n              } else {\n                find[i + 1] = find[i + 1].substring(5);\n              }\n            }\n\n            tmp = find.join('');\n            find = tmp.split('<image id=\"');\n\n            for (_i = find.length - 1; _i--;) {\n              imageNum = _parseInt(find[_i + 1].charAt(0));\n\n              if (res.data.images[imageNum - 1]) {\n                find[_i + 1] = '<img src=\"https://data.joornalo.com/news/4/c/' + res.data.images[imageNum - 1].url + '\" />' + find[_i + 1].substring(5);\n              } else {\n                find[_i + 1] = find[_i + 1].substring(5);\n              }\n            }\n\n            res.data.modText = Parser(find.join('')); //res.data.modText = Parser('<p>ok</p>')\n\n            res.data.mainImgUrl = 'https://data.joornalo.com/news/4/c/' + res.data.images[0].url; //console.log(data);\n\n            dispatch({\n              type: GET_NEWS,\n              payload: {\n                news: res.data,\n                template: template\n              }\n            });\n            _context3.next = 29;\n            break;\n\n          case 26:\n            _context3.prev = 26;\n            _context3.t0 = _context3[\"catch\"](0);\n            dispatch({\n              type: NEWS_ERROR,\n              payload: 'NotFound'\n            });\n\n          case 29:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 26]]);\n  };\n}; // Set loading to true\n\nexport var setLoading = function setLoading() {\n  return {\n    type: SET_LOADING\n  };\n};\nexport var getConfig = function getConfig(req) {\n  return function _callee3(dispatch) {\n    var configUrl, templatesUrl, _ref, _ref2, config, templates, agent;\n\n    return _regeneratorRuntime.async(function _callee3$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            configUrl = \"https://data.joornalo.com/config.json\";\n            templatesUrl = \"https://data.joornalo.com/templates/news/templates.json\";\n            _context4.next = 5;\n            return _regeneratorRuntime.awrap(_Promise.all([axios.get(configUrl), axios.get(templatesUrl), initAgent(req)]));\n\n          case 5:\n            _ref = _context4.sent;\n            _ref2 = _slicedToArray(_ref, 3);\n            config = _ref2[0];\n            templates = _ref2[1];\n            agent = _ref2[2];\n            dispatch({\n              type: GET_CONFIG,\n              payload: {\n                config: config.data,\n                templates: templates.data,\n                agent: agent\n              }\n            });\n            _context4.next = 15;\n            break;\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t0 = _context4[\"catch\"](0);\n\n          case 15:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 13]]);\n  };\n};","map":null,"metadata":{},"sourceType":"module"}