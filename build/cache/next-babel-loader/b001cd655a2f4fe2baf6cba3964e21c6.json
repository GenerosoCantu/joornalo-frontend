{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport store from '../../pages/store';\nimport { GET_NEWS, SET_LOADING, ADD_TEMPLATE, NEWS_ERROR, INIT_AGENT, GET_CONFIG, GET_OTHERNEWS, FRONT_ERROR, GET_FRONT } from '../types';\nimport { initAgent, test } from '../../services/configService';\nimport axios from 'axios';\nimport Parser from 'html-react-parser';\n\nvar getTemplate = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(req, template, agent) {\n    var tmpl, templateUrl, res;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            setLoading();\n            tmpl = agent + '-' + template;\n            templateUrl = \"https://data.joornalo.com/templates/news/\".concat(tmpl, \".json\");\n            console.log(templateUrl);\n            _context.next = 7;\n            return axios.get(templateUrl);\n\n          case 7:\n            res = _context.sent;\n            return _context.abrupt(\"return\", res.data);\n\n          case 11:\n            _context.prev = 11;\n            _context.t0 = _context[\"catch\"](0);\n            console.log('***********Template Error');\n            dispatch({\n              type: NEWS_ERROR,\n              payload: _context.t0.statusText\n            });\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 11]]);\n  }));\n\n  return function getTemplate(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport var getOtherNews = function getOtherNews(section) {\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch, getState) {\n      var moreUrl, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              setLoading();\n              moreUrl = \"https://data.joornalo.com/news/\".concat(section, \"-more-news.json\");\n              _context2.next = 5;\n              return axios.get(moreUrl);\n\n            case 5:\n              res = _context2.sent;\n              dispatch({\n                type: GET_OTHERNEWS,\n                payload: {\n                  topNews: res.data.topNews,\n                  moreNews: res.data.moreNews\n                }\n              });\n              _context2.next = 12;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              dispatch({\n                type: NEWS_ERROR,\n                payload: 'NotFound'\n              });\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n\n    return function (_x4, _x5) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n};\nexport var getNews = function getNews(section, date, uuid, url, req) {\n  return /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch, getState) {\n      var path, res, agent, tmpl, template;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              setLoading();\n              path = \"https://data.joornalo.com/news/\".concat(uuid.charAt(0), \"/\").concat(uuid.charAt(1), \"/\").concat(uuid, \".json\");\n              _context3.next = 5;\n              return axios.get(path);\n\n            case 5:\n              res = _context3.sent;\n\n              if (url !== res.data['url']) {\n                dispatch({\n                  type: NEWS_ERROR,\n                  payload: \"Redirect: \".concat(res.data['url'])\n                });\n              }\n\n              agent = getState().news.agent;\n              tmpl = agent + '-' + res.data['template'];\n              template = getState().news.templates[tmpl];\n\n              if (template) {\n                _context3.next = 15;\n                break;\n              }\n\n              _context3.next = 13;\n              return getTemplate(req, res.data['template'], getState().news.agent);\n\n            case 13:\n              template = _context3.sent;\n              dispatch({\n                type: ADD_TEMPLATE,\n                payload: {\n                  template: _defineProperty({}, tmpl, template)\n                }\n              });\n\n            case 15:\n              dispatch({\n                type: GET_NEWS,\n                payload: {\n                  news: res.data,\n                  templateName: 'template-' + res.data['template'],\n                  template: template\n                }\n              });\n              _context3.next = 21;\n              break;\n\n            case 18:\n              _context3.prev = 18;\n              _context3.t0 = _context3[\"catch\"](0);\n              dispatch({\n                type: NEWS_ERROR,\n                payload: 'NotFound'\n              });\n\n            case 21:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 18]]);\n    }));\n\n    return function (_x6, _x7) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n};\nexport var getFront = function getFront(section, req) {\n  return /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch, getState) {\n      var path, res, agent, tmpl, template;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              setLoading();\n              path = \"https://data.joornalo.com/sections/latest/\".concat(section, \".json\");\n              _context4.next = 5;\n              return axios.get(path);\n\n            case 5:\n              res = _context4.sent;\n              // if (url !== res.data['url']) {\n              //   dispatch({\n              //     type: FRONT_ERROR,\n              //     payload: `Redirect: ${res.data['url']}`\n              //   });\n              // }\n              agent = getState().news.agent;\n              tmpl = agent + '-' + res.data['template'];\n              template = getState().news.templates[tmpl];\n\n              if (template) {\n                _context4.next = 14;\n                break;\n              }\n\n              _context4.next = 12;\n              return getTemplate(req, res.data['template'], getState().news.agent);\n\n            case 12:\n              template = _context4.sent;\n              dispatch({\n                type: ADD_TEMPLATE,\n                payload: {\n                  template: _defineProperty({}, tmpl, template)\n                }\n              });\n\n            case 14:\n              //console.log(res.data)\n              dispatch({\n                type: GET_FRONT,\n                payload: {\n                  front: res.data,\n                  templateName: 'template-' + res.data['template'],\n                  template: template\n                }\n              });\n              _context4.next = 21;\n              break;\n\n            case 17:\n              _context4.prev = 17;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.log('FRONT_ERROR--------------------');\n              dispatch({\n                type: FRONT_ERROR,\n                payload: 'NotFound'\n              });\n\n            case 21:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 17]]);\n    }));\n\n    return function (_x8, _x9) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n}; // Set loading to true\n\nexport var setLoading = function setLoading() {\n  return {\n    type: SET_LOADING\n  };\n};\nexport var getConfig = function getConfig(req) {\n  return /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch) {\n      var configUrl, templatesUrl, _yield$Promise$all, _yield$Promise$all2, config, templates, agent;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              configUrl = \"https://data.joornalo.com/config.json\";\n              templatesUrl = \"https://data.joornalo.com/templates/news/templates.json\";\n              _context5.next = 5;\n              return Promise.all([axios.get(configUrl), axios.get(templatesUrl), initAgent(req)]);\n\n            case 5:\n              _yield$Promise$all = _context5.sent;\n              _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 3);\n              config = _yield$Promise$all2[0];\n              templates = _yield$Promise$all2[1];\n              agent = _yield$Promise$all2[2];\n              dispatch({\n                type: GET_CONFIG,\n                payload: {\n                  config: config.data,\n                  templates: templates.data,\n                  agent: agent\n                }\n              });\n              _context5.next = 15;\n              break;\n\n            case 13:\n              _context5.prev = 13;\n              _context5.t0 = _context5[\"catch\"](0);\n\n            case 15:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 13]]);\n    }));\n\n    return function (_x10) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n};","map":null,"metadata":{},"sourceType":"module"}