{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport store from '../../pages/store';\nimport { GET_NEWS, SET_LOADING, ADD_TEMPLATE, NEWS_ERROR, INIT_AGENT, GET_CONFIG, GET_OTHERNEWS } from '../types';\nimport { initAgent, test } from '../../services/configService';\nimport axios from 'axios';\nimport Parser from 'html-react-parser';\n\nconst getTemplate = async (req, template, agent) => {\n  try {\n    setLoading();\n    const tmpl = agent + '-' + template;\n    const templateUrl = `https://data.joornalo.com/templates/news/${tmpl}.json`;\n    const res = await axios.get(templateUrl);\n    return res.data;\n  } catch (err) {\n    console.log('***********Template Error');\n    dispatch({\n      type: NEWS_ERROR,\n      payload: err.statusText\n    });\n  }\n};\n\nexport const getOtherNews = section => async (dispatch, getState) => {\n  try {\n    setLoading();\n    const moreUrl = `https://data.joornalo.com/news/${section}-more-news.json`;\n    const res = await axios.get(moreUrl);\n    dispatch({\n      type: GET_OTHERNEWS,\n      payload: {\n        topNews: res.data.topNews,\n        moreNews: res.data.moreNews\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: NEWS_ERROR,\n      payload: 'NotFound'\n    });\n  }\n};\nexport const getNews = (section, date, uuid, url, req) => async (dispatch, getState) => {\n  try {\n    setLoading();\n    const path = `https://data.joornalo.com/news/${uuid.charAt(0)}/${uuid.charAt(1)}/${uuid}.json`;\n    const res = await axios.get(path);\n\n    if (url !== res.data['url']) {\n      dispatch({\n        type: NEWS_ERROR,\n        payload: `Redirect: ${res.data['url']}`\n      });\n    }\n\n    const agent = getState().news.agent;\n    const tmpl = agent + '-' + res.data['template'];\n    let template = getState().news.templates[tmpl];\n\n    if (!template) {\n      template = await getTemplate(req, res.data['template'], getState().news.agent);\n      dispatch({\n        type: ADD_TEMPLATE,\n        payload: {\n          template: {\n            [tmpl]: template\n          }\n        }\n      });\n    }\n\n    let tmp = unescape(res.data.text);\n    let find = tmp.split('<embed id=\"');\n\n    for (let i = find.length - 1; i--;) {\n      let mediaNum = _parseInt(find[i + 1].charAt(0));\n\n      if (res.data.media[mediaNum - 1]) {\n        find[i + 1] = '<div class=\"embed\">' + res.data.media[mediaNum - 1].embed + '</div>' + find[i + 1].substring(5);\n      } else {\n        find[i + 1] = find[i + 1].substring(5);\n      }\n    }\n\n    tmp = find.join('');\n    find = tmp.split('<image id=\"');\n\n    for (let i = find.length - 1; i--;) {\n      let imageNum = _parseInt(find[i + 1].charAt(0));\n\n      if (res.data.images[imageNum - 1]) {\n        find[i + 1] = '<img src=\"https://data.joornalo.com/news/4/c/' + res.data.images[imageNum - 1].url + '\" />' + find[i + 1].substring(5);\n      } else {\n        find[i + 1] = find[i + 1].substring(5);\n      }\n    }\n\n    res.data.modText = Parser(find.join(''));\n    res.data.modText = res.data.text;\n    res.data.mainImgUrl = 'https://data.joornalo.com/news/4/c/' + res.data.images[0].url; //console.log(data);\n\n    dispatch({\n      type: GET_NEWS,\n      payload: {\n        news: res.data,\n        template: template\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: NEWS_ERROR,\n      payload: 'NotFound'\n    });\n  }\n}; // Set loading to true\n\nexport const setLoading = () => {\n  return {\n    type: SET_LOADING\n  };\n};\nexport const getConfig = req => async dispatch => {\n  try {\n    const configUrl = `https://data.joornalo.com/config.json`;\n    const templatesUrl = `https://data.joornalo.com/templates/news/templates.json`;\n    const [config, templates, agent] = await _Promise.all([axios.get(configUrl), axios.get(templatesUrl), initAgent(req)]);\n    dispatch({\n      type: GET_CONFIG,\n      payload: {\n        config: config.data,\n        templates: templates.data,\n        agent: agent\n      }\n    });\n  } catch (err) {// dispatch({\n    //   type: NEWS_ERROR,\n    //   payload: 'NotFound'\n    // });\n  }\n};","map":{"version":3,"sources":["C:/Projects/DEVELOPMENT/joornalo-frontend/front.joornalo/store/actions/newsActions.js"],"names":["store","GET_NEWS","SET_LOADING","ADD_TEMPLATE","NEWS_ERROR","INIT_AGENT","GET_CONFIG","GET_OTHERNEWS","initAgent","test","axios","Parser","getTemplate","req","template","agent","setLoading","tmpl","templateUrl","res","get","data","err","console","log","dispatch","type","payload","statusText","getOtherNews","section","getState","moreUrl","topNews","moreNews","getNews","date","uuid","url","path","charAt","news","templates","tmp","unescape","text","find","split","i","length","mediaNum","media","embed","substring","join","imageNum","images","modText","mainImgUrl","getConfig","configUrl","templatesUrl","config","all"],"mappings":"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","sourcesContent":["import store from '../../pages/store';\r\nimport { GET_NEWS, SET_LOADING, ADD_TEMPLATE, NEWS_ERROR, INIT_AGENT, GET_CONFIG, GET_OTHERNEWS } from '../types';\r\nimport { initAgent, test } from '../../services/configService';\r\nimport axios from 'axios';\r\nimport Parser from 'html-react-parser';\r\n\r\n\r\nconst getTemplate = async (req, template, agent) => {\r\n  try {\r\n    setLoading();\r\n\r\n    const tmpl = agent + '-' + template;\r\n    const templateUrl = `https://data.joornalo.com/templates/news/${tmpl}.json`;\r\n\r\n    const res = await axios.get(templateUrl);\r\n\r\n    return res.data;\r\n\r\n  } catch (err) {\r\n    console.log('***********Template Error');\r\n    dispatch({\r\n      type: NEWS_ERROR,\r\n      payload: err.statusText\r\n    });\r\n  }\r\n\r\n};\r\n\r\nexport const getOtherNews = (section) => async (dispatch, getState) => {\r\n  try {\r\n    setLoading();\r\n\r\n    const moreUrl = `https://data.joornalo.com/news/${section}-more-news.json`;\r\n\r\n    const res = await axios.get(moreUrl);\r\n\r\n    dispatch({\r\n      type: GET_OTHERNEWS,\r\n      payload: {\r\n        topNews: res.data.topNews,\r\n        moreNews: res.data.moreNews,\r\n      }\r\n    });\r\n\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEWS_ERROR,\r\n      payload: 'NotFound'\r\n    });\r\n  }\r\n};\r\n\r\nexport const getNews = (section, date, uuid, url, req) => async (dispatch, getState) => {\r\n  try {\r\n    setLoading();\r\n\r\n    const path = `https://data.joornalo.com/news/${uuid.charAt(0)}/${uuid.charAt(1)}/${uuid}.json`\r\n\r\n    const res = await axios.get(path);\r\n\r\n    if (url !== res.data['url']) {\r\n      dispatch({\r\n        type: NEWS_ERROR,\r\n        payload: `Redirect: ${res.data['url']}`\r\n      });\r\n    }\r\n\r\n    const agent = getState().news.agent;\r\n    const tmpl = agent + '-' + res.data['template'];\r\n\r\n    let template = getState().news.templates[tmpl];\r\n\r\n    if (!template) {\r\n      template = await getTemplate(req, res.data['template'], getState().news.agent);\r\n      dispatch({\r\n        type: ADD_TEMPLATE,\r\n        payload: {\r\n          template: { [tmpl]: template }\r\n        }\r\n      });\r\n    }\r\n\r\n    let tmp = unescape(res.data.text);\r\n    let find = tmp.split('<embed id=\"');\r\n\r\n    for (let i = find.length - 1; i--;) {\r\n      let mediaNum = parseInt(find[i + 1].charAt(0));\r\n      if (res.data.media[mediaNum - 1]) {\r\n        find[i + 1] = '<div class=\"embed\">' + res.data.media[mediaNum - 1].embed + '</div>' + find[i + 1].substring(5);\r\n      } else {\r\n        find[i + 1] = find[i + 1].substring(5);\r\n      }\r\n    }\r\n\r\n    tmp = find.join('');\r\n    find = tmp.split('<image id=\"');\r\n    for (let i = find.length - 1; i--;) {\r\n      let imageNum = parseInt(find[i + 1].charAt(0));\r\n      if (res.data.images[imageNum - 1]) {\r\n        find[i + 1] = '<img src=\"https://data.joornalo.com/news/4/c/' + res.data.images[imageNum - 1].url + '\" />' + find[i + 1].substring(5);\r\n      } else {\r\n        find[i + 1] = find[i + 1].substring(5);\r\n      }\r\n    }\r\n\r\n    res.data.modText = Parser(find.join(''));\r\n\r\n    res.data.modText = res.data.text;\r\n\r\n\r\n    res.data.mainImgUrl = 'https://data.joornalo.com/news/4/c/' + res.data.images[0].url;\r\n\r\n    //console.log(data);\r\n\r\n    dispatch({\r\n      type: GET_NEWS,\r\n      payload: {\r\n        news: res.data,\r\n        template: template\r\n      }\r\n    });\r\n\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEWS_ERROR,\r\n      payload: 'NotFound'\r\n    });\r\n  }\r\n};\r\n\r\n// Set loading to true\r\nexport const setLoading = () => {\r\n  return {\r\n    type: SET_LOADING\r\n  };\r\n};\r\n\r\n\r\nexport const getConfig = (req) => async dispatch => {\r\n  try {\r\n    const configUrl = `https://data.joornalo.com/config.json`\r\n    const templatesUrl = `https://data.joornalo.com/templates/news/templates.json`;\r\n\r\n    const [config, templates, agent] = await Promise.all([\r\n      axios.get(configUrl),\r\n      axios.get(templatesUrl),\r\n      initAgent(req)\r\n    ]);\r\n\r\n    dispatch({\r\n      type: GET_CONFIG,\r\n      payload: {\r\n        config: config.data,\r\n        templates: templates.data,\r\n        agent: agent\r\n      }\r\n    });\r\n\r\n  } catch (err) {\r\n    // dispatch({\r\n    //   type: NEWS_ERROR,\r\n    //   payload: 'NotFound'\r\n    // });\r\n  }\r\n};"]},"metadata":{},"sourceType":"module"}